<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>DirtySock: cryptarc4.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../eadp-horizontal-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">DirtySock
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d7/d9b/cryptarc4_8c.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">cryptarc4.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This module is a from-scratch ARC4 implementation designed to avoid any intellectual property complications. The ARC4 stream cipher is known to produce output that is compatible with the RC4 stream cipher.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="../../de/d03/platform_8h_source.html">DirtySDK/platform.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="../../d3/d87/dirtylib_8h_source.html">DirtySDK/dirtysock/dirtylib.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="../../de/de1/cryptarc4_8h_source.html">DirtySDK/crypt/cryptarc4.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="../../d5/d57/cryptrand_8h_source.html">DirtySDK/crypt/cryptrand.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af218b779b906070a99034454d988617c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d9b/cryptarc4_8c.html#af218b779b906070a99034454d988617c">CryptArc4Init</a> (<a class="el" href="../../d4/d86/structCryptArc4T.html">CryptArc4T</a> *pState, const uint8_t *pKeyBuf, int32_t iKeyLen, int32_t iIter)</td></tr>
<tr class="memdesc:af218b779b906070a99034454d988617c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize state for ARC4 encryption/decryption module.  <a href="#af218b779b906070a99034454d988617c">More...</a><br/></td></tr>
<tr class="separator:af218b779b906070a99034454d988617c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07b6fd8611682b38fd507a9e2d51224e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d9b/cryptarc4_8c.html#a07b6fd8611682b38fd507a9e2d51224e">CryptArc4Apply</a> (<a class="el" href="../../d4/d86/structCryptArc4T.html">CryptArc4T</a> *pState, uint8_t *pBuffer, int32_t iLength)</td></tr>
<tr class="memdesc:a07b6fd8611682b38fd507a9e2d51224e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply the cipher to the data. Uses reversible XOR so calling twice undoes the uncryption (assuming the key state has been reset).  <a href="#a07b6fd8611682b38fd507a9e2d51224e">More...</a><br/></td></tr>
<tr class="separator:a07b6fd8611682b38fd507a9e2d51224e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9ddc404fd42b85ee8f589399818409e0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/group__CryptArc4.html#ga9ddc404fd42b85ee8f589399818409e0">CryptArc4Advance</a> (<a class="el" href="../../d4/d86/structCryptArc4T.html">CryptArc4T</a> *pState, int32_t iLength)</td></tr>
<tr class="memdesc:ga9ddc404fd42b85ee8f589399818409e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Advance the cipher state with by iLength bytes.  <a href="../../d1/d75/group__CryptArc4.html#ga9ddc404fd42b85ee8f589399818409e0">More...</a><br/></td></tr>
<tr class="separator:ga9ddc404fd42b85ee8f589399818409e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf6fa5653f2db3e2b7bddbde0c6441051"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/group__CryptArc4.html#gaf6fa5653f2db3e2b7bddbde0c6441051">CryptArc4StringEncrypt</a> (char *pDst, int32_t iLen, const char *pSrc, const uint8_t *pKey, int32_t iKey, int32_t iIter)</td></tr>
<tr class="memdesc:gaf6fa5653f2db3e2b7bddbde0c6441051"><td class="mdescLeft">&#160;</td><td class="mdescRight">Easy way to encode an asciiz string. The resulting string is iLen chars of visible ascii characters. String characters must fall in the range of 32 to 127 to be considered valid.  <a href="../../d1/d75/group__CryptArc4.html#gaf6fa5653f2db3e2b7bddbde0c6441051">More...</a><br/></td></tr>
<tr class="separator:gaf6fa5653f2db3e2b7bddbde0c6441051"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4e91575da105c9e1af6bc6987b42d0b3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/group__CryptArc4.html#ga4e91575da105c9e1af6bc6987b42d0b3">CryptArc4StringDecrypt</a> (char *pDst, int32_t iLen, const char *pSrc, const uint8_t *pKey, int32_t iKey, int32_t iIter)</td></tr>
<tr class="memdesc:ga4e91575da105c9e1af6bc6987b42d0b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decode an asciiz string encoded with CryptArc4StringEncrypt.  <a href="../../d1/d75/group__CryptArc4.html#ga4e91575da105c9e1af6bc6987b42d0b3">More...</a><br/></td></tr>
<tr class="separator:ga4e91575da105c9e1af6bc6987b42d0b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa03c92587add3e207e6676c7eaf2975f"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/group__CryptArc4.html#gaa03c92587add3e207e6676c7eaf2975f">CryptArc4StringEncryptStaticCode</a> (char *pStr, int32_t iStrSize, const uint8_t *pKey, int32_t iKeySize, const char *pStrSrc)</td></tr>
<tr class="memdesc:gaa03c92587add3e207e6676c7eaf2975f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function decrypts an encrypted key/encoded string pair into the source plaintext string. It also accepts the plaintext string as an argument to verify that the source plaintext string matches the resulting decrypted string. If there is a mismatch updated key and encoded string data is printed in c-style array form and an error is returned. The source plaintext string parameter is only referenced in debug builds to prevent the plaintext string from leaking into the release binary. The <a class="el" href="../../d1/d75/group__CryptArc4.html#ga3fee72fc023ace560a4c572682e1f11d">CryptArc4StringEncryptStatic()</a> macro wrapper should always be used to call this function, and the plaintext string itself should be defined via the preprocessor, to prevent the plaintext string from leaking into the release binary.  <a href="../../d1/d75/group__CryptArc4.html#gaa03c92587add3e207e6676c7eaf2975f">More...</a><br/></td></tr>
<tr class="separator:gaa03c92587add3e207e6676c7eaf2975f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This module is a from-scratch ARC4 implementation designed to avoid any intellectual property complications. The ARC4 stream cipher is known to produce output that is compatible with the RC4 stream cipher. </p>
<dl class="section note"><dt>Note</dt><dd>This algorithm from this cypher was taken from the web site: ciphersaber.gurus.com. It is based on the RC4 compatible algorithm that was published in the 2nd ed of the book Applied Cryptography by Bruce Schneier. This is a private-key stream cipher which means that some other secure way of exchanging cipher keys prior to algorithm use is required. Its strength is directly related to the key exchange algorithm strength. In operation, each individual stream message must use a unique key. This is handled by appending on 10 byte random value onto the private key. This 10-byte data can be sent by public means to the receptor (or included at the start of a file or whatever). When the private key is combined with this public key, it essentially puts the cypher into a random starting state (it is like using a message digest routine to generate a random hash for password comparison). The code below was written from scratch using only a textual algorithm description.</dd></dl>
<dl class="section attention"><dt>Attention</dt><dd>Copyright (c) 2000-2005 Electronic Arts Inc.</dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0 02/25/2000 (gschaefer) First Version </dd>
<dd>
1.1 11/06/2002 (jbrookes) Removed Create()/Destroy() to eliminate mem alloc dependencies. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a07b6fd8611682b38fd507a9e2d51224e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CryptArc4Apply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d4/d86/structCryptArc4T.html">CryptArc4T</a> *&#160;</td>
          <td class="paramname"><em>pState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>iLength</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Apply the cipher to the data. Uses reversible XOR so calling twice undoes the uncryption (assuming the key state has been reset). </p>
<p><a class="anchor" id="CryptArc4Apply"></a> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*pState</td><td>- module state </td></tr>
    <tr><td class="paramname">*pBuffer</td><td>- buffer to encrypt/decrypt </td></tr>
    <tr><td class="paramname">iLength</td><td>- length of buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="section version"><dt>Version</dt><dd>02/26/2000 (gschaefer) </dd></dl>

<p>References <a class="el" href="../../d4/d86/structCryptArc4T.html#a108ed9adaae214812fadd0fcf2f6097a">CryptArc4T::state</a>, <a class="el" href="../../d4/d86/structCryptArc4T.html#ada17dfeab39857e6d11675daae72e0bb">CryptArc4T::swap</a>, and <a class="el" href="../../d4/d86/structCryptArc4T.html#af1f8f003429fa80b9c1a2362cebe4abe">CryptArc4T::walk</a>.</p>

<p>Referenced by <a class="el" href="../../d1/d75/group__CryptArc4.html#ga4e91575da105c9e1af6bc6987b42d0b3">CryptArc4StringDecrypt()</a>, <a class="el" href="../../d1/d75/group__CryptArc4.html#gaf6fa5653f2db3e2b7bddbde0c6441051">CryptArc4StringEncrypt()</a>, and <a class="el" href="../../d1/d75/group__CryptArc4.html#gaa03c92587add3e207e6676c7eaf2975f">CryptArc4StringEncryptStaticCode()</a>.</p>

</div>
</div>
<a class="anchor" id="af218b779b906070a99034454d988617c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CryptArc4Init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d4/d86/structCryptArc4T.html">CryptArc4T</a> *&#160;</td>
          <td class="paramname"><em>pState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>pKeyBuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>iKeyLen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>iIter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize state for ARC4 encryption/decryption module. </p>
<p><a class="anchor" id="CryptArc4Init"></a> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*pState</td><td>- module state </td></tr>
    <tr><td class="paramname">*pKeyBuf</td><td>- pointer to crypt key </td></tr>
    <tr><td class="paramname">iKeyLen</td><td>- length of crypt key (sixteen for RC4-128) </td></tr>
    <tr><td class="paramname">iIter</td><td>- internal iterator (1=RC4 compat, larger for slightly improved security</td></tr>
  </table>
  </dd>
</dl>
<dl class="section version"><dt>Version</dt><dd>02/26/2000 (gschaefer) </dd></dl>

<p>References <a class="el" href="../../d1/d75/group__CryptArc4.html#ga9ddc404fd42b85ee8f589399818409e0">CryptArc4Advance()</a>, <a class="el" href="../../d4/d86/structCryptArc4T.html#a108ed9adaae214812fadd0fcf2f6097a">CryptArc4T::state</a>, <a class="el" href="../../d4/d86/structCryptArc4T.html#ada17dfeab39857e6d11675daae72e0bb">CryptArc4T::swap</a>, and <a class="el" href="../../d4/d86/structCryptArc4T.html#af1f8f003429fa80b9c1a2362cebe4abe">CryptArc4T::walk</a>.</p>

<p>Referenced by <a class="el" href="../../d1/d75/group__CryptArc4.html#ga4e91575da105c9e1af6bc6987b42d0b3">CryptArc4StringDecrypt()</a>, <a class="el" href="../../d1/d75/group__CryptArc4.html#gaf6fa5653f2db3e2b7bddbde0c6441051">CryptArc4StringEncrypt()</a>, and <a class="el" href="../../d1/d75/group__CryptArc4.html#gaa03c92587add3e207e6676c7eaf2975f">CryptArc4StringEncryptStaticCode()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<table x-use-null-cells
        style="float: alignright;
                width: 100%;
                border-spacing: 0px;"
        cellspacing=0
        width=100%>
<tr>
<td style="text-align: left;
            padding-left: 0px;
            padding-top: 0px;
            padding-right: 0px;
            padding-bottom: 0px;"
    align=left><span style="font-family: Arial, sans-serif; font-size: 8pt;">EA Digital Platform</span></td>
<td style="text-align: right;
            padding-left: 0px;
            padding-top: 0px;
            padding-right: 0px;
            padding-bottom: 0px;"
    align=right><span style="font-family: Arial, sans-serif; font-size: 8pt;">&#169;
 2014 Electronic Arts Inc.</span><br />
<span style="font-family: Arial, sans-serif; font-size: 8pt;">Generated
 on: Fri Oct 21 2016 13:35:44</span><br />
</td></tr>
</table>

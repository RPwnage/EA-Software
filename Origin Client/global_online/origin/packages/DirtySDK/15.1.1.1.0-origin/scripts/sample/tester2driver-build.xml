<project>
    <!-- Needed for package.xenonsdk.appdir -->
    <dependent name="xenonsdk"/>

    <Program name="T2Driver" frompartial="DSProgram">
        <includedirs>
            ${package.dir}/sample/common/include
            ${package.dir}/sample/tester2/source
            ${package.dir}/sample/tester2/source/${config-system}/resource
            ${package.dir}/sample/tester2/contrib/t2xbdm/include/xenon
        </includedirs>

        <sourcefiles basedir="${package.dir}">
            <includes fromfile="${package.dir}/sample/tester2/project/${config-system}/driversource.txt"/>
            <includes fromfile="${package.dir}/sample/tester2/project/${config-system}/driversourcecpp.txt"/>
        </sourcefiles>

        <dependencies>
            <auto>
                DirtySDK/dirtysock
            </auto>
        </dependencies>

        <config>
            <warningsuppression if="${config-compiler} == 'vc'">
                -wd4127 <!-- conditional expression is constant -->
            </warningsuppression>
        </config>

        <buildsteps>
            <postbuild-step>
                <target if="${config-system} == 'pc'" hidden="true">
                    <copy if="@{FileExists('${package.dir}/sample/tester2/contrib/t2xbdm/bin/xenon/t2xbdmxenon.dll')}" file="${package.dir}/sample/tester2/contrib/t2xbdm/bin/xenon/t2xbdmxenon.dll" todir="${package.configbindir}" />
                    <copy if="@{FileExists('${package.xenonsdk.appdir}/bin/win32/mspdb70.dll')}" file="${package.xenonsdk.appdir}/bin/win32/mspdb70.dll" todir="${package.configbindir}" />
                    <copy if="@{FileExists('${package.xenonsdk.appdir}/bin/win32/xbdm.dll')}" file="${package.xenonsdk.appdir}/bin/win32/xbdm.dll" todir="${package.configbindir}" />
                </target>
            </postbuild-step>
        </buildsteps>

        <visualstudio>
            <post-build-step if="${config-system} == 'pc'">
                ${nant.location}/nant.exe runtime.T2Driver.postbuildtarget -buildfile:${nant.project.buildfile} -buildroot:${nant.project.buildroot} -masterconfigfile:${nant.project.masterconfigfile} -D:config=${config} -D:dirtysdk-samples=${dirtysdk-samples}
            </post-build-step>
        </visualstudio>
    </Program>
</project>

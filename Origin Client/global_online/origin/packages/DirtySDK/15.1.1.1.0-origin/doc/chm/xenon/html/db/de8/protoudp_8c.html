<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>DirtySock: protoudp.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../eadp-horizontal-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">DirtySock
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('db/de8/protoudp_8c.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">protoudp.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This module provides a generic UDP interface.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="../../d1/dc9/dirtysock_8h_source.html">DirtySDK/dirtysock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="../../d7/d4c/dirtymem_8h_source.html">DirtySDK/dirtysock/dirtymem.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="../../dd/db9/protoudp_8h_source.html">DirtySDK/proto/protoudp.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/da6/structProtoUdpT.html">ProtoUdpT</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a5d80db0da04509f72b5f5ec15da467e4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/de8/protoudp_8c.html#a5d80db0da04509f72b5f5ec15da467e4">PROTOUDP_PKTPREFIXSIZE</a>&#160;&#160;&#160;(sizeof(int32_t)+sizeof(struct sockaddr_in))</td></tr>
<tr class="memdesc:a5d80db0da04509f72b5f5ec15da467e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">size of data that prefixes packet data in packet buffer  <a href="#a5d80db0da04509f72b5f5ec15da467e4">More...</a><br/></td></tr>
<tr class="separator:a5d80db0da04509f72b5f5ec15da467e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gabfef1677010bd67f406cf2c754746d15"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/da6/structProtoUdpT.html">ProtoUdpT</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d2f/group__ProtoUdp.html#gabfef1677010bd67f406cf2c754746d15">ProtoUdpCreate</a> (int32_t iMaxPacketSize, int32_t iMaxPackets)</td></tr>
<tr class="memdesc:gabfef1677010bd67f406cf2c754746d15"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a proto udp instance.  <a href="../../d5/d2f/group__ProtoUdp.html#gabfef1677010bd67f406cf2c754746d15">More...</a><br/></td></tr>
<tr class="separator:gabfef1677010bd67f406cf2c754746d15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabfe6be9c3509493baaaf3f8d15535f74"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d2f/group__ProtoUdp.html#gabfe6be9c3509493baaaf3f8d15535f74">ProtoUdpBind</a> (<a class="el" href="../../da/da6/structProtoUdpT.html">ProtoUdpT</a> *pUdp, int32_t iPort)</td></tr>
<tr class="memdesc:gabfe6be9c3509493baaaf3f8d15535f74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Bind the source port for all outbound packets.  <a href="../../d5/d2f/group__ProtoUdp.html#gabfe6be9c3509493baaaf3f8d15535f74">More...</a><br/></td></tr>
<tr class="separator:gabfe6be9c3509493baaaf3f8d15535f74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa1fa3db0e94a2b0e1004c52d5b3c3dc5"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d2f/group__ProtoUdp.html#gaa1fa3db0e94a2b0e1004c52d5b3c3dc5">ProtoUdpConnect</a> (<a class="el" href="../../da/da6/structProtoUdpT.html">ProtoUdpT</a> *pUdp, struct sockaddr *pRemoteAddr)</td></tr>
<tr class="memdesc:gaa1fa3db0e94a2b0e1004c52d5b3c3dc5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Bind the remote address of the socket.  <a href="../../d5/d2f/group__ProtoUdp.html#gaa1fa3db0e94a2b0e1004c52d5b3c3dc5">More...</a><br/></td></tr>
<tr class="separator:gaa1fa3db0e94a2b0e1004c52d5b3c3dc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa939dad0242c69142f67274ca9039e78"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d2f/group__ProtoUdp.html#gaa939dad0242c69142f67274ca9039e78">ProtoUdpDestroy</a> (<a class="el" href="../../da/da6/structProtoUdpT.html">ProtoUdpT</a> *pUdp)</td></tr>
<tr class="memdesc:gaa939dad0242c69142f67274ca9039e78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroy the UDP instance.  <a href="../../d5/d2f/group__ProtoUdp.html#gaa939dad0242c69142f67274ca9039e78">More...</a><br/></td></tr>
<tr class="separator:gaa939dad0242c69142f67274ca9039e78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga81ef0fc51eb388402e8532cd8000e187"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d2f/group__ProtoUdp.html#ga81ef0fc51eb388402e8532cd8000e187">ProtoUdpDisconnect</a> (<a class="el" href="../../da/da6/structProtoUdpT.html">ProtoUdpT</a> *pUdp)</td></tr>
<tr class="memdesc:ga81ef0fc51eb388402e8532cd8000e187"><td class="mdescLeft">&#160;</td><td class="mdescRight">Undo the effect of any previous ProtoUdpConnect.  <a href="../../d5/d2f/group__ProtoUdp.html#ga81ef0fc51eb388402e8532cd8000e187">More...</a><br/></td></tr>
<tr class="separator:ga81ef0fc51eb388402e8532cd8000e187"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaec649313095cd0dc689de42f9c46cc99"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d2f/group__ProtoUdp.html#gaec649313095cd0dc689de42f9c46cc99">ProtoUdpGetLocalAddr</a> (<a class="el" href="../../da/da6/structProtoUdpT.html">ProtoUdpT</a> *pUdp, struct sockaddr_in *pLocalAddr)</td></tr>
<tr class="memdesc:gaec649313095cd0dc689de42f9c46cc99"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the local IPv4 address and port that is on all outbound packets. Only works if ProtoUdpConnect has been called to bind the remote address.  <a href="../../d5/d2f/group__ProtoUdp.html#gaec649313095cd0dc689de42f9c46cc99">More...</a><br/></td></tr>
<tr class="separator:gaec649313095cd0dc689de42f9c46cc99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa83f5f3bf1d341813ee27fd1e3ac7ac2"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d2f/group__ProtoUdp.html#gaa83f5f3bf1d341813ee27fd1e3ac7ac2">ProtoUdpRecvFrom</a> (<a class="el" href="../../da/da6/structProtoUdpT.html">ProtoUdpT</a> *pUdp, char *pBuffer, uint32_t uBufferLen, struct sockaddr *pRemoteAddr)</td></tr>
<tr class="memdesc:gaa83f5f3bf1d341813ee27fd1e3ac7ac2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if there is a udp packet available and if so returns it.  <a href="../../d5/d2f/group__ProtoUdp.html#gaa83f5f3bf1d341813ee27fd1e3ac7ac2">More...</a><br/></td></tr>
<tr class="separator:gaa83f5f3bf1d341813ee27fd1e3ac7ac2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5c218989cfbeedca1e51595eb6e67ae2"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d2f/group__ProtoUdp.html#ga5c218989cfbeedca1e51595eb6e67ae2">ProtoUdpSend</a> (<a class="el" href="../../da/da6/structProtoUdpT.html">ProtoUdpT</a> *pUdp, const char *pData, int32_t <a class="el" href="../../d6/da2/protossl_8c.html#a6b7e12df96eb1a3c79f68c7f959175fe">iSize</a>)</td></tr>
<tr class="memdesc:ga5c218989cfbeedca1e51595eb6e67ae2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send data to the host that was connected to via ProtoUdpConnect.  <a href="../../d5/d2f/group__ProtoUdp.html#ga5c218989cfbeedca1e51595eb6e67ae2">More...</a><br/></td></tr>
<tr class="separator:ga5c218989cfbeedca1e51595eb6e67ae2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4698370c4c40c1aee6b87301d8b4ff50"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d2f/group__ProtoUdp.html#ga4698370c4c40c1aee6b87301d8b4ff50">ProtoUdpSendTo</a> (<a class="el" href="../../da/da6/structProtoUdpT.html">ProtoUdpT</a> *pUdp, const char *pData, int32_t <a class="el" href="../../d6/da2/protossl_8c.html#a6b7e12df96eb1a3c79f68c7f959175fe">iSize</a>, struct sockaddr *pRemoteAddr)</td></tr>
<tr class="memdesc:ga4698370c4c40c1aee6b87301d8b4ff50"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send data to the specified address.  <a href="../../d5/d2f/group__ProtoUdp.html#ga4698370c4c40c1aee6b87301d8b4ff50">More...</a><br/></td></tr>
<tr class="separator:ga4698370c4c40c1aee6b87301d8b4ff50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9a447a2eeebe700d22d8836c1f6a2353"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d2f/group__ProtoUdp.html#ga9a447a2eeebe700d22d8836c1f6a2353">ProtoUdpUpdate</a> (<a class="el" href="../../da/da6/structProtoUdpT.html">ProtoUdpT</a> *pUdp)</td></tr>
<tr class="memdesc:ga9a447a2eeebe700d22d8836c1f6a2353"><td class="mdescLeft">&#160;</td><td class="mdescRight">Do any necessary internal processing.  <a href="../../d5/d2f/group__ProtoUdp.html#ga9a447a2eeebe700d22d8836c1f6a2353">More...</a><br/></td></tr>
<tr class="separator:ga9a447a2eeebe700d22d8836c1f6a2353"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This module provides a generic UDP interface. </p>
<dl class="section note"><dt>Note</dt><dd>This was initially written to support the TickerApi. That has modest bandwidth requirements, only one packet every few seconds, and can accept moderate packet loss. As such this API is only a relatively thin layer over a plain UDP socket with some buffering on packet reception. Historically so that on the PS2 the IOP can read multiple packets without the EE having to be interrupted for each packet.</dd></dl>
<p>The buffering is in the form of a queue of packets where the maximum size of the queue and the maximum size of each packet in the queue are specified by the client.</p>
<p>There are various ways to implement a queue of packets, but to keep the memory allocation and error handling as simple as possible a block of memory is allocated at startup that is large enough to hold the maximum number of packets.</p>
<p>All the packets are continguous in memory with each packet having the form :- </p>
<pre class="fragment"> 0     1     2     3            len+4
</pre><p> +--&mdash;+--&mdash;+--&mdash;+---&mdash;+.......+---&mdash;+.....+---&mdash;+ | | | | | | | | | +--&mdash;+--&mdash;+--&mdash;+---&mdash;+.......+---&mdash;+.....+---&mdash;+ | len |&lt;&mdash; len -&mdash;&gt;| | | |&lt;---&mdash; max packet size &ndash;&gt;|</p>
<p>That is all packets are the same length (whatever size the user specifies at startup) and the 4 bytes at the start of the packet indicate the actual number of bytes in the packet (4 bytes is rather generous, 2 is probably sufficient).</p>
<p>The packets are treated as a queue with the head were the client reads a packet from and the tail where new packets are added. To reduce the number of (hidden) multiplications during indexing the head and tail values are the byte offset of the start of the packet. So for example, if the user requested a maximum packet size of 40 bytes and a 5 element queue then 220 bytes would be allocated to hold the packets, that's 5 * (40 + 4) where the +4 is to cover the 4 bytes at the start of each packet to hold the length. The byte offsets of the 5 packets would be: 0, 44, 88, 132 and 176 therefore these are the 5 possible values for the head and tail offsets in the queue.</p>
<dl class="section attention"><dt>Attention</dt><dd>Copyright (c) Electronic Arts 2003. ALL RIGHTS RESERVED.</dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0 12/11/2003 (sbevan) First Version </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a5d80db0da04509f72b5f5ec15da467e4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PROTOUDP_PKTPREFIXSIZE&#160;&#160;&#160;(sizeof(int32_t)+sizeof(struct sockaddr_in))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>size of data that prefixes packet data in packet buffer </p>

<p>Referenced by <a class="el" href="../../d5/d2f/group__ProtoUdp.html#gabfef1677010bd67f406cf2c754746d15">ProtoUdpCreate()</a>, and <a class="el" href="../../d5/d2f/group__ProtoUdp.html#gaa83f5f3bf1d341813ee27fd1e3ac7ac2">ProtoUdpRecvFrom()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<table x-use-null-cells
        style="float: alignright;
                width: 100%;
                border-spacing: 0px;"
        cellspacing=0
        width=100%>
<tr>
<td style="text-align: left;
            padding-left: 0px;
            padding-top: 0px;
            padding-right: 0px;
            padding-bottom: 0px;"
    align=left><span style="font-family: Arial, sans-serif; font-size: 8pt;">EA Digital Platform</span></td>
<td style="text-align: right;
            padding-left: 0px;
            padding-top: 0px;
            padding-right: 0px;
            padding-bottom: 0px;"
    align=right><span style="font-family: Arial, sans-serif; font-size: 8pt;">&#169;
 2014 Electronic Arts Inc.</span><br />
<span style="font-family: Arial, sans-serif; font-size: 8pt;">Generated
 on: Fri Jun 5 2015 16:26:55</span><br />
</td></tr>
</table>

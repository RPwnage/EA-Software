<project>
    <tests unless="${Dll??false}">
        <Program name="EadpFoundation-test">
            <dependencies>
                <build>
                    ${runtime.EadpFoundation.builddependencies}
                </build>
                <auto>
                    ${runtime.EadpFoundation.autodependencies}
                    EAMain
                    gtest
                    MemoryMan
                    PPMalloc
                    <do if="${config-system} == 'capilano' or ${config-system} == 'kettle'">
                        IEASystemEventMessageDispatcher
                        EAMessage
                        EASystemEventMessageDispatcher
                    </do>
                </auto>
            </dependencies>
            <config>
                <defines>
                    EADPSDK_PACKAGE_NAME="EadpFoundation"
                    ${runtime.EadpFoundation.defines}
                </defines>
            </config>
            <sdkreferences if="${config-system} == 'capilano'">
                Xbox Services API, Version=8.0
            </sdkreferences>
            
            <includedirs>
                ${package.dir}/test/include
                ${package.dir}/test/source/gen/include
                ${runtime.EadpFoundation.includedirs}
            </includedirs>
            <headerfiles>
                <includes name="${package.dir}/test/**.h" />
                <includes fromfileset="runtime.EadpFoundation.headerfiles" />
            </headerfiles>
            <sourcefiles>
                <includes name="${package.dir}/test/**.cpp" />
                <includes fromfileset="runtime.EadpFoundation.sourcefiles" />
            </sourcefiles>

            <platforms>
                <iphone>
                    <extra-link-options>
                        -weak_framework AdSupport 
                    </extra-link-options>
                </iphone>
            </platforms>
            <visualstudio>
                <excludedbuildfiles>
                    <includes name="proto/*.proto" basedir="${package.dir}/test/" if="${EadpFoundation.ShowProtoFiles??false}"/>
                </excludedbuildfiles>
            </visualstudio>
        </Program>
        <Program name="EadpFoundation-test-codegen" if="${config-system} == 'pc64' or ${config-system} == 'iphone'">
            <dependencies>
                <auto>
                    ${runtime.EadpFoundation.autodependencies}
                    EadpFoundation/EadpFoundation
                    EAMain
                    gtest
                    MemoryMan
                    PPMalloc
                    protobuf
                    <do if="${config-system} == 'capilano' or ${config-system} == 'kettle'">
                        IEASystemEventMessageDispatcher
                        EAMessage
                        EASystemEventMessageDispatcher
                    </do>
                </auto>
            </dependencies>
            <config>
                <defines>
                    ${package.EadpFoundation.sharedDefines}
                    EADP_PROTOBUF_VALIDATION_ENABLED=1
                </defines>
                <warningsuppression>
                    <do if="${config-compiler} == 'vc'">
                        <!-- Suppress these warnings, as they are from code generated by original 
                             protobuf tool instead of EADP protobuf plug-in -->
                        -wd4125 <!-- decimal digit terminates octal sequence -->
                        -wd4146 <!-- unary minus operator applied to unsigned type, result still unsigned -->
                        -wd4251 <!-- class 'X' needs to have dll-interface to be used by clients of class 'Y' -->
                        -wd4267 <!-- return: conversion, possible loss of data -->
                        -wd4456 <!-- declaration hides previous declaration -->
                        -wd4464 <!-- use of parent-directory specifier '..' -->
                        -wd4505 <!-- unreferenced local function has been removed -->
                        -wd4548 <!-- expression before comma has no effect -->
                        -wd4623 <!-- default constructor was implicitly defined as deleted -->
                        -wd4625 <!-- copy constructor was implicitly defined as deleted -->
                        -wd4626 <!-- assignment operator was implicitly defined as deleted -->
                        -wd4628 <!-- digraphs not supported with -Ze. Character sequence '<:' not interpreted as alternate token for '[' -->
                        -wd4800 <!-- forcing value to bool 'true' or 'false' -->
                        -wd4946 <!-- reinterpret_cast used between related types -->
                        -wd4996 <!-- std::copy::_Unchecked_iterators::_Deprecate': Call to 'std::copy' with parameters that may be unsafe -->
                        -wd5026 <!-- move constructor operator was implicitly defined as deleted -->
                        -wd5027 <!-- move assignment operator was implicitly defined as deleted -->
                    </do>
                </warningsuppression>
            </config>
            <includedirs>
                ${package.dir}/codegen/test/include
                ${package.EadpFoundation.dir}/test/include
            </includedirs>
            <headerfiles>
                <includes name="${package.dir}/codegen/test/**.h"/>
                <includes name="${package.EadpFoundation.dir}/test/include/test/util/*.h"/>
            </headerfiles>
            <sourcefiles>
                <includes name="${package.dir}/codegen/test/**.cpp" />
                <includes name="${package.dir}/codegen/test/**.cc" />
                <includes name="${package.EadpFoundation.dir}/test/source/test/util/*.cpp"/>
                <includes name="${package.EadpFoundation.dir}/test/main.cpp" />
            </sourcefiles>
            <platforms>
                <iphone>
                    <extra-link-options>
                        -weak_framework AdSupport 
                        -weak_framework iAd
                    </extra-link-options>
                </iphone>
            </platforms>
            <!-- This also works for XCode. "excludedbuildfiles" defines a list of files that are excluded from the build but are added to the visual studio project as non-buildable files. -->
            <visualstudio>
                <excludedbuildfiles>
                    <includes name="proto/*.proto" basedir="${package.dir}/codegen/test/" if="${EadpFoundation.ShowProtoFiles??false}"/>
                </excludedbuildfiles>
            </visualstudio>
        </Program>

    </tests>
</project>

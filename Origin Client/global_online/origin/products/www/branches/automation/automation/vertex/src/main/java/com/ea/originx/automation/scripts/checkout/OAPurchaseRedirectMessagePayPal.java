package com.ea.originx.automation.scripts.checkout;import com.ea.originx.automation.lib.macroaction.MacroLogin;import com.ea.originx.automation.lib.pageobjects.dialog.CheckoutRedirectMessageDefaultDialog;import com.ea.originx.automation.lib.pageobjects.dialog.PayPalDialog;import com.ea.originx.automation.lib.pageobjects.store.PaymentInformationPage;import com.ea.originx.automation.lib.pageobjects.store.ReviewOrderPage;import com.ea.originx.automation.lib.resources.games.EntitlementId;import com.ea.originx.automation.lib.resources.games.EntitlementInfoHelper;import com.ea.originx.automation.scripts.EAXVxTestTemplate;import com.ea.vx.annotations.TestRail;import com.ea.vx.originclient.account.AccountManager;import com.ea.vx.originclient.account.UserAccount;import com.ea.vx.originclient.client.OriginClient;import com.ea.vx.originclient.client.OriginClientFactory;import com.ea.vx.originclient.resources.games.EntitlementInfo;import org.openqa.selenium.WebDriver;import org.testng.ITestContext;import org.testng.annotations.Test;/** * * Tests checkout redirect message for 'PayPal' payment flow * * NEEDS UPDATE TO GDP * * @author SeanLi * */public class OAPurchaseRedirectMessagePayPal extends EAXVxTestTemplate {    @TestRail(caseId = 11911)    @Test(groups = {"checkout", "browser_only"})    public void testPurchaseRedirectMessagePayPal(ITestContext context) throws Exception {        final OriginClient client = OriginClientFactory.create(context);        final UserAccount userAccount = AccountManager.getInstance().createNewThrowAwayAccount();        EntitlementInfo game = EntitlementInfoHelper.getEntitlementInfoForId(EntitlementId.BF4_STANDARD);        logFlowPoint("Launch Origin and login as a newly registered user"); // 1        logFlowPoint("Navigate to an entitlement's PDP page, click 'Buy' CTA and verify checkout flow started"); // 2        logFlowPoint("Select 'PayPal' as the payment method"); // 3        logFlowPoint("Verify 'Review Order' page is reached and click 'Pay Now' CTA"); // 4        logFlowPoint("Verify 'PayPal' window opens in a new window/tab"); // 5        logFlowPoint("Navigate back to the main window and verify a dialog appears titled as 'Third Party Payment Provider'"); // 6        // 1        WebDriver driver = startClientObject(context, client);        if (MacroLogin.startLogin(driver, userAccount)) {            logPass("Verified a newly registered user '" + userAccount.getUsername() + "' logged in");        } else {            logFailExit("Failed to logged in as a newly registered user");        }        // 2       // MacroPDP.loadPdpPage(driver, game);        // new PDPHeroActionCTA(driver).clickBuyButton();        PaymentInformationPage paymentPage = new PaymentInformationPage(driver);        paymentPage.waitForPaymentInfoPageToLoad();        if (paymentPage.verifyPaymentInformationReached()) {            logPass("Successfully navigated to " + game.getName() + "'s PDP and triggered the checkout flow");        } else {            logFailExit("Failed to navigate to to an entitlement's PDP and trigger the checkout flow");        }        // 3        paymentPage.selectPayPal();        if (paymentPage.verifyPayPalSelected()) {            logPass("Successfully selected 'PayPal' as the payment method");        } else {            logFailExit("Failed to select 'PayPal' as the payment method");        }        // 4        paymentPage.clickContinueToPayPal();        ReviewOrderPage reviewOrderPage = new ReviewOrderPage(driver);        reviewOrderPage.waitForPageToLoad();        if (reviewOrderPage.verifyReviewOrderPageReached()) {            logPass("Verified a 'Review Order' page is reached");        } else {            logFailExit("Could not reach the 'Review Order' page");        }        //5        reviewOrderPage.clickPayNow();        PayPalDialog dialog = new PayPalDialog(driver);        String mainPage = driver.getWindowHandle();        dialog.focusDialog();        String payPalPage = driver.getWindowHandle();        if (mainPage != payPalPage) {            logPass("'PayPal' window/tab is opened");        } else {            logFailExit("'PayPal' window/tab failed to open");        }        //6        driver.switchTo().window(mainPage);        CheckoutRedirectMessageDefaultDialog redirectMessageDialog = new CheckoutRedirectMessageDefaultDialog(driver);        if (redirectMessageDialog.verifyRedirectMessageType()) {            logPass("A redirect message dialog appears and is titled 'Third Party Payment Provider Selected'");        } else {            logFail("A redirect message dialog that titled 'Third Party Payment Provider Selected' does not appear");        }        client.stop();        softAssertAll();    }}
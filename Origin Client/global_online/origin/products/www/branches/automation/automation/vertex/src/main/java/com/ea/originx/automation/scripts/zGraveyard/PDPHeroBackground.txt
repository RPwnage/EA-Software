package com.ea.originx.automation.lib.pageobjects.store;

import com.ea.originx.automation.lib.macroaction.MacroAgeGate;
import com.ea.originx.automation.lib.pageobjects.template.EAXVxSiteTemplate;
import java.text.ParseException;
import org.openqa.selenium.By;
import org.openqa.selenium.TimeoutException;
import org.openqa.selenium.WebDriver;

/**
 * Used for PDP Heroes that have a video/image attached
 *
 * @author sbentley/nvarthakavi
 */
public class PDPHeroBackground extends EAXVxSiteTemplate {

    //PDP Image
    protected final By PDP_HERO_BLUR_IMAGE_LOCATOR = By.cssSelector(".origin-pdp-hero-background .origin-store-blurimage");

    //PDP Video
    private final By VIDEO_AGEGATE_FORM_LOCATOR = By.cssSelector(".origin-agegate-form");
    private final By VIDEO_PLAY_BUTTON_LOCATOR = By.cssSelector(".origin-pdp-hero-videobutton");
    private final By PLAY_VIDEO_CTA_LOCATOR = By.cssSelector("origin-cta-playvideo");
    private final By VIDEO_AGEGATE_SELECT_LOCATOR = By.cssSelector(".otkselect.origin-agegate-select");
    private final By VIDEO_AGEGATE_OKAY_BUTTON_LOCATOR = By.cssSelector(".origin-agegate-buttons");
    private final By VIDEO_AGEGATE_RESTRICTED_MESSAGE_LOCATOR = By.cssSelector(".origin-agegate.origin-agegate-underage-yes");

    /**
     * Constructor
     *
     * @param driver Selenium WebDriver
     */
    public PDPHeroBackground(WebDriver driver) {
        super(driver);
    }

    /**
     * Clicks the 'Play' button on the hero video.
     */
    public void clickVideoPlayButton() {
        waitForElementClickable(VIDEO_PLAY_BUTTON_LOCATOR).click();
    }

    /**
     * Checks to see if age gate has become visible.
     *
     * @return true if age gate is visible, false otherwise
     */
    public boolean verifyVideoAgeGate() {
        return waitIsElementVisible(VIDEO_AGEGATE_FORM_LOCATOR);
    }

    /**
     * Enters the given age into the video age gate.
     *
     * @param birthday The birthday to enter (mm/dd/yy)
     * @throws java.text.ParseException
     */
    public void enterVideoAgeGateBirthday(String birthday) throws ParseException {
        MacroAgeGate.enterVideoAgeGateBirthday(birthday, waitForAllElementsVisible(VIDEO_AGEGATE_SELECT_LOCATOR), waitForElementClickable(VIDEO_AGEGATE_OKAY_BUTTON_LOCATOR));
    }

    /**
     * Checks to see if the restricted messaging for video age gate appears.
     *
     * @return true if restricted age gate message is presented, false otherwise
     */
    public boolean verifyVideoAgeGateRestrictedMessage() {
        return waitIsElementVisible(VIDEO_AGEGATE_RESTRICTED_MESSAGE_LOCATOR);
    }

    /**
     * Verify the Background Image is visible
     *
     * @return true if the background image is visible
     */
    public boolean verifyHeroBackgroundVisible() {
        return waitIsElementVisible(PDP_HERO_BLUR_IMAGE_LOCATOR);
    }

    /**
     * Get the Video Id
     *
     * @return the background video id
     */
    public String getVideoID() {
        try {
            return waitForElementVisible(PLAY_VIDEO_CTA_LOCATOR).getAttribute("video-id");
        } catch (TimeoutException e) {
            return "";
        }
    }

}

package com.ea.originx.automation.scripts.pdp;

import com.ea.originx.automation.lib.macroaction.MacroPDP;
import com.ea.originx.automation.lib.pageobjects.store.PDPHeroActionDescriptors;
import com.ea.vx.annotations.TestRail;
import com.ea.vx.originclient.client.OriginClient;
import com.ea.vx.originclient.client.OriginClientFactory;
import com.ea.originx.automation.lib.resources.games.Sims4;
import com.ea.originx.automation.scripts.EAXVxTestTemplate;
import org.openqa.selenium.WebDriver;
import org.testng.ITestContext;
import org.testng.annotations.Test;

/**
 * Test to verify buying a DLC at its PDP Page opens a 'Base Game Message'
 * dialog with a link to the PDP of the base game
 *
 * @author palui
 */
public class OAPDPBaseGameMessage extends EAXVxTestTemplate {

    @TestRail(caseId = 1613991)
    @Test(groups = {"pdp", "full_regression", "browser_only"})
    public void testPDPBaseGameMessage(ITestContext context) throws Exception {

        final OriginClient client = OriginClientFactory.create(context);

        String dlcName = Sims4.SIMS4_DLC_BACKYARD_NAME;
        String dlcOfferID = Sims4.SIMS4_DLC_BACKYARD_OFFER_ID;
        String dlcPartialPDPUrl = Sims4.SIMS4_DLC_BACKYARD_PARTIAL_PDP_URL;

        logFlowPoint("Navigate to the DLC page for " + dlcName + " on the Origin store"); //1
        logFlowPoint("Verify a message appears on the page indicating the full game is necessary to use the DLC"); //2

        //1
        WebDriver driver = startClientObject(context, client);
        logPassFail(MacroPDP.loadPdpPage(driver, dlcName, dlcOfferID, dlcPartialPDPUrl), true);

        //2
        PDPHeroActionDescriptors pdpHeroActionDescriptors = new PDPHeroActionDescriptors(driver);
        boolean baseGameRequiredInfoVisible = pdpHeroActionDescriptors.verifyBaseGameRequiredMessageVisible()
                && pdpHeroActionDescriptors.verifyBaseGameRequiredLinkExist();
        logPassFail(baseGameRequiredInfoVisible, true);

        softAssertAll();
    }

}

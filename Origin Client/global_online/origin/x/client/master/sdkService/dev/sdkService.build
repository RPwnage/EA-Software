<?xml version="1.0" encoding="utf-8"?>
<project default="build"> 
    <!-- ************************* -->
    <!-- EAConfig target overrides -->
    <!-- ************************* -->
  <optionset name="config.targetoverrides" >
    <option name="clean" value="exclude"/>
  </optionset>

  <!-- ******************* -->
    <!-- Package declaration -->
    <!-- ******************* -->
    <property name="package.sdkService.dir"  value="@{PathGetFullPath('.')}"/>
    <property name="package.sdkService.version"  value="@{PathGetFileName('${package.sdkService.dir}')}"/>
    <package name="sdkService" targetversion="${package.sdkService.version}"/>
  
  <!-- ******************** -->
    <!-- Package dependencies -->
    <!-- ******************** -->
  <dependent name="OriginVersion" />
  <dependent name="OriginConfig" />
  <dependent name="Qt" />
  <dependent name="libjingle" />
  <dependent name="LocalHost" />
  
    <!-- ***************************** -->
	<!-- Build Configuration properties-->
	<!-- ***************************** -->
	<BuildType name="sdkService.buildtype" from="OriginLibrary">
		<option name="buildset.cc.defines">
		  ${option.value}
		  ${package.libjingle.extra-defines}
		</option>

    <option name="buildset.cc.defines">
      ${option.value}
      _WINSOCKAPI_
    </option>
    <option name="buildset.cc.options" if="${config-system} == pc">
      ${option.value}
      /FI ${package.sdkService.dir}/include/Service/OriginCommon.h
    </option>
	</BuildType>	
    <property name="runtime.buildtype" value="sdkService.buildtype" />

  <!-- NANT Prebuild target. Will execute this first before any compiling happens. -->
  <property name="runtime.prebuildtarget" value="moc-compile" />
  
  <!-- VS Prebuild target. Will set this to execute in the VS project. -->
  <property name="runtime.vcproj.pre-build-step">
    ${nant.location}/nant.exe -buildfile:${nant.project.buildfile}  -masterconfigfile:${nant.project.masterconfigfile} -D:config=${config} ${runtime.prebuildtarget}
  </property>
  
  <property name="runtime.builddependencies">
	LSXWrapper
    LocalHost
  </property>

  <property name="runtime.usedependencies">
    OriginConfig
    OriginVersion
    ChatModel
    services
    engine
    BugSentry
    coreallocator
    openSSL
    DirtySDK
    EABase
    EACallstack
    EAIO
    EAStdC
    EASTL
    EAThread
    EATrace
    Qt
    OriginLegacyApp
    TelemetryAPI
    libjingle
    uitoolkit
    LocalHost
  </property>  
  
  <property name="runtime.interfacedependencies">
    originClient
  </property>  

  
  <property name="osx-extra-frameworks" value="-framework AppKit -framework Carbon -framework IOKit -framework SystemConfiguration -framework ${package.Qt.libdir}/QtCore -framework ${package.Qt.libdir}/QtGui -framework ${package.Qt.libdir}/QtNetwork  -framework ${package.Qt.libdir}/QtOpenGL -framework ${package.Qt.libdir}/QtWebKit  -framework ${package.Qt.libdir}/QtXml  -framework ${package.Qt.libdir}/QtXmlPatterns -framework Security -framework ServiceManagement -framework Foundation" />

  <dependent name="originClient" />

  <property name="package.originClient.dir" value="@{PathGetFullPath('.')}/../../originClient/dev"/>

  <property name="package.originClient.includedirs">
    ${package.originClient.dir}
    ${package.originClient.dir}/flows
    ${package.originClient.dir}/widgets/logoutExit/source
    ${package.originClient.dir}/common/source
    ${package.originClient.dir}/common/source
    ${package.originClient.dir}/websupport/source
  </property>
  
  <property name="package.engine.dir" value="@{PathGetFullPath('.')}/../../engine/dev"/>

  <property name="package.engine.includedirs">
    ${package.engine.dir}/igo/source
  </property>

  <property name="runtime.includedirs" >
    ${package.sdkService.dir}/include
    ${package.sdkService.dir}/source
    ${package.originClient.includedirs}
    ${package.engine.includedirs}
    ${package.LocalHost.dir}/include
  </property>
    
  <!-- common source files -->
  <fileset name="runtime.sourcefiles" basedir="${package.dir}">
    <includes name="${package.sdkService.dir}/source/**/*.cpp" />
  </fileset>

  <fileset name="runtime.libs" >
    <group if="${config-system} == 'pc'">
      <includes name="${package.Qt.libdir}/qtmain${debug-suffix}.lib"/>
      <includes name="${package.Qt.libdir}/QtSql${debug-suffix}4.lib"/>
      <includes name="${package.Qt.libdir}/QtXml${debug-suffix}4.lib"/>
      <includes name="${package.Qt.libdir}/QtGui${debug-suffix}4.lib"/>
      <includes name="${package.Qt.libdir}/QtNetwork${debug-suffix}4.lib"/>
      <includes name="${package.Qt.libdir}/QtCore${debug-suffix}4.lib"/>
      <includes name="${package.Qt.libdir}/QtDesigner${debug-suffix}4.lib"/>
      <includes name="${package.Qt.libdir}/QtDesignerComponents${debug-suffix}4.lib"/>
      <includes name="${package.Qt.libdir}/QtWebKit${debug-suffix}4.lib"/>
      <includes name="${package.Qt.libdir}/QtDesigner${debug-suffix}4.lib"/>
      <includes name="${package.Qt.libdir}/QtDesignerComponents${debug-suffix}4.lib"/>
     </group>
  </fileset>

  <target name="dumpsources">
    <foreach property="fname" item="FileSet" in="runtime.sourcefiles">
      <echo message="source ${fname}" />
    </foreach>
  </target>
  
  <fileset name="runtime.headerfiles" basedir="${package.dir}">
    <includes name="${package.sdkService.dir}/**/*.h" />
  </fileset>
  
  <!-- these are the moc source files that generate the mocfiles that need to be included in the build. -->
  <fileset name="runtime.moc_sourcefiles" basedir="${package.sdkService.dir}" append="true"> 
	<includes name="${package.dir}/include/LSX/LSX_Handler.h" />
	<includes name="${package.dir}/include/LSX/LsxConnection.h" />
	<includes name="${package.dir}/include/LSX/LsxServer.h" />
	<includes name="${package.dir}/include/LSX/LsxTcpConnection.h" />
	<includes name="${package.dir}/include/LSX/TCPServer.h" />
    <includes name="${package.dir}/include/LSX/JSServer.h" />
    <includes name="${package.dir}/include/LSX/WebSocket.h" />
    <includes name="${package.dir}/include/LSX/TcpSocket.h" />
    <includes name="${package.dir}/include/LSX/LsxSocket.h" />
	<includes name="${package.dir}/include/Service/BaseService.h" />
	<includes name="${package.dir}/include/Service/XMPPService/XMPP_ServiceArea.h" />
	<includes name="${package.dir}/include/Service/SDKService/SDK_eCommerce_ServiceArea.h" />
	<includes name="${package.dir}/include/Service/SDKService/SDK_ServiceArea.h" />
    <includes name="${package.dir}/include/Service/SDKService/SDK_EntitlementManager.h" />
    <includes name="${package.dir}/include/Service/ProgressiveinstallationService/ProgressiveInstallation_ServiceArea.h" />
    <includes name="${package.dir}/source/localHost/LocalHostServices/AuthenticationRequestStatusService.h" />
    <includes name="${package.dir}/source/localHost/LocalHostServices/PingServerService.h" />
    <includes name="${package.dir}/include/LocalHost/LocalHostOriginConfig.h" />
  </fileset>

  <!-- construct the paths to include the moc files into the build after generating. -->
  <foreach property="fname" item="FileSet" in="runtime.moc_sourcefiles">
    <property name="sourcefile" value="${moc.output.dir}/moc_@{PathGetFileNameWithoutExtension(${fname})}.cpp" />
    <fileset name="runtime.sourcefiles" append="true">
      <includes name="${sourcefile}" asis="true"/>
    </fileset>
  </foreach>
  
  <!-- get the options from the current config -->
	<property name="runtime.moc_defines" value="@{OptionSetGetValue('${runtime.buildtype}','cc.defines')}"/>
  <property name="runtime.moc_includedirs" value="${runtime.includedirs}"/>
  
</project>

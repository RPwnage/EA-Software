<project default="build">
    <optionset name="config.targetoverrides" >
        <option name="clean" value="exclude"/>
        <option name="build" value="exclude"/>
    </optionset>
    
    <!-- ******************* -->
    <!-- Package declaration -->
    <!-- ******************* -->
    <property name="package.Sonar.dir"  value="@{PathGetFullPath('.')}"/>
    <property name="package.Sonar.version"  value="@{PathGetFileName('${package.Sonar.dir}')}"/>
    <package name="Sonar" targetversion="${package.Sonar.version}"/>
    
	<dependent name="VisualStudio"/>
	
    <target name="clean" >
        <do if="${config-system} == 'pc'">
            <exec program="${package.VisualStudio.devenv}" workingdir=".">
                <args>
                    <arg value="${package.Sonar.dir}/dist/sonarlibs/SonarLibs.sln"/>
                    <arg value="/Clean"/>
                    <arg value="ReleaseStatic"/>
                </args>
            </exec>
            <exec program="${package.VisualStudio.devenv}" workingdir=".">
                <args>
                    <arg value="${package.Sonar.dir}/dist/sonarlibs/SonarLibs.sln"/>
                    <arg value="/Clean"/>
                    <arg value="DebugStatic"/>
                </args>
            </exec>
        </do>
    </target>
    
    <target name="build">
        <do if="${config-system} == 'pc'">
            <exec program="${package.VisualStudio.devenv}" workingdir=".">
                <args>
                    <arg value="${package.Sonar.dir}/dist/sonarlibs/SonarLibs.sln"/>
                    <arg value="/Build"/>
                    <arg value="ReleaseStatic"/>
                </args>
            </exec>
            <exec program="${package.VisualStudio.devenv}" workingdir=".">
                <args>
                    <arg value="${package.Sonar.dir}/dist/sonarlibs/SonarLibs.sln"/>
                    <arg value="/Build"/>
                    <arg value="DebugStatic"/>
                </args>
            </exec>
        </do>
    </target>
    
    <target name="copy-libs">
        <do if="${config-system} == 'pc'">
            <copy todir="${package.Sonar.dir}/libs/opt" >
                <fileset basedir="${package.Sonar.dir}/dist/sonarlibs/ReleaseStatic">
                    <includes name="jlib.lib" />
                    <includes name="libspeex.lib" />
                    <includes name="SonarAudio.lib" />
                    <includes name="SonarClient.lib" />
                    <includes name="SonarCommon.lib" />
                    <includes name="SonarConnection.lib" />
                    <includes name="SonarInput.lib" />
                    <includes name="SonarIpcClient.lib" />
                    <includes name="SonarIpcCommon.lib" />
                    <includes name="SonarIpcHost.lib" />
                </fileset>
            </copy>
            <copy todir="${package.Sonar.dir}/libs/debug" >
                <fileset basedir="${package.Sonar.dir}/dist/sonarlibs/DebugStatic">
                    <includes name="jlib.lib" />
                    <includes name="libspeex.lib" />
                    <includes name="SonarAudio.lib" />
                    <includes name="SonarClient.lib" />
                    <includes name="SonarCommon.lib" />
                    <includes name="SonarConnection.lib" />
                    <includes name="SonarInput.lib" />
                    <includes name="SonarIpcClient.lib" />
                    <includes name="SonarIpcCommon.lib" />
                    <includes name="SonarIpcHost.lib" />
                    <includes name="*.pdb" />
                    <includes name="*pdb_index" />
                </fileset>
            </copy>
        </do>
    </target>
</project>


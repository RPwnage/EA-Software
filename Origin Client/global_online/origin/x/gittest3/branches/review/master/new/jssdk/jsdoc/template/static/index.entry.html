<!DOCTYPE html>

<html> 
  <head>
<style type="text/css">
html 
{
 overflow: auto;
}
 
html, body, div, iframe 
{
 margin: 0px; 
 padding: 0px; 
 height: 100%; 
 border: none;
}
 
iframe 
{
 display: block; 
 width: 100%; 
 border: none; 
 overflow-y: auto; 
 overflow-x: hidden;
}
</style>
        <script src="scripts/promise-polyfill/Promise.js"></script>
        <script src="scripts/strophe/strophe.js"></script>
        <script src="scripts/origin-jssdk.js"></script>
  </head>
  <body>

    



<iframe id="tree" name="theFrame" frameborder="0" marginheight="0" marginwidth="0" width="100%" height="100%" scrolling="auto"><h1>WAITING FOR LOGIN<..../h1></iframe>

    <script>
        var oauth = 'https://accounts.int.ea.com/connect/auth?response_type=token&scope=basic.identity+basic.persona+signin+offline&client_id=ORIGIN_PC&locale=en_US';
        var loc = window.location.origin + window.location.pathname;
        var dir = loc.substring(0, loc.lastIndexOf('/'));
        oauth += '&redirect_uri=';
        oauth += dir + '/login.html';

        function eventListening() {
            var events = window.Origin.events;
            var callbacks = [];


            for (var key in events) {
                if(key === 'map' || key ==='priv') {
                    continue;
                }
                console.log(key);
                if (events.hasOwnProperty(key)) {
                    Origin._tmp[key] = {
                        responses: []
                    };
                    Origin.events.on(events[key], (function(param) {
                        return function() {
                            var respList = Origin._tmp[param].responses;
                            console.log('event received for:' + param + ': ' + JSON.stringify(arguments[0]));
                            respList.push(arguments[0]);
                            if (respList.length > 50)
                                respList.pop();

                            if (Origin._tmp[param].update) {
                                Origin._tmp[param].update(arguments[0]);
                            }
                        };
                    })(key))
                }
            }
        }
         // window.open (oauth, 'myWindow', 'width=200, height=100');
        function initComplete() {
            console.log('init done');
            window.open('home.html', 'theFrame');
            window.originSocialConnected = false;
            Origin.events.on(Origin.events.XMPP_CONNECTED, function() {
                window.originSocialConnected = true;
                Origin.xmpp.updatePresence();
              window.open('home.html', 'theFrame');
            })

            Origin._tmp = {};
            eventListening();
        }

        Origin.init({
            env: 'qa',
            overrideUrls: {
                feedStories: 'https://dev-proxy.x.origin.com:1415/feeds/{feedType}/{locale}/{index}'
            }
        }).then(initComplete);


        window.logoutCompleteCallback = function() {
           window.originSocialConnected = false;
            setTimeout(function() {
                window.location.href = 'index.html';
            }, 20);
        }
    </script>


        
</body>
</html>

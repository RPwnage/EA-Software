<project default="regress" xmlns="schemas/ea/framework3.xsd">

	<package/>

	<Program name="TopProgram" outputdir="${package.configbindir}/TopProgram">
		<copylocal>true</copylocal>
		<sourcefiles>
			<includes name="main.cpp"/>
		</sourcefiles>
		<dependencies>
			<auto>
				StadiaTransitiveSo/MidSo
				StadiaTransitiveSo/MidLib
			</auto>
		</dependencies>
	</Program>

	<DynamicLibrary name="MidSo" outputdir="${package.configbindir}/MidSo">
		<headerfiles>
			<includes name="midso.h"/>
		</headerfiles>
		<sourcefiles>
			<includes name="midso.cpp"/>
		</sourcefiles>
		<dependencies>
			<auto>
				StadiaTransitiveSo/BotSoViaMidSo
			</auto>
			<build link="false">
				StadiaTransitiveSo/BotSoViaMidSoNoLink
			</build>
		</dependencies>
	</DynamicLibrary>

	<DynamicLibrary name="BotSoViaMidSo" outputdir="${package.configbindir}/BotSoViaMidSo">
		<headerfiles>
			<includes name="botviamidso.h"/>
		</headerfiles>
		<sourcefiles>
			<includes name="botviamidso.cpp"/>
		</sourcefiles>
	</DynamicLibrary>

	<DynamicLibrary name="BotSoViaMidSoNoLink" outputdir="${package.configbindir}/BotSoViaMidSoNoLink">
		<headerfiles>
			<includes name="botviamidsonolink.h"/>
		</headerfiles>
		<sourcefiles>
			<includes name="botviamidsonolink.cpp"/>
		</sourcefiles>
	</DynamicLibrary>

	<Library name="MidLib" outputdir="${package.configlibdir}/MidLib">
		<headerfiles>
			<includes name="midlib.h"/>
		</headerfiles>
		<sourcefiles>
			<includes name="midlib.cpp"/>
		</sourcefiles>
		<dependencies>
			<auto>
				StadiaTransitiveSo/BotSoViaMidLib
			</auto>
			<build link="false">
				StadiaTransitiveSo/BotSoViaMidLibNoLink
			</build>
		</dependencies>
	</Library>

	<DynamicLibrary name="BotSoViaMidLib" outputdir="${package.configbindir}/BotSoViaMidLib">
		<headerfiles>
			<includes name="botviamidlib.h"/>
		</headerfiles>
		<sourcefiles>
			<includes name="botviamidlib.cpp"/>
		</sourcefiles>
	</DynamicLibrary>

	<DynamicLibrary name="BotSoViaMidLibNoLink" outputdir="${package.configbindir}/BotSoViaMidLibNoLink">
		<headerfiles>
			<includes name="botviamidlibnolink.h"/>
		</headerfiles>
		<sourcefiles>
			<includes name="botviamidlibnolink.cpp"/>
		</sourcefiles>
	</DynamicLibrary>

	<target name="regress" depends="slnruntime msbuild">
		<fail unless="@{FileExists('${package.configbindir}/TopProgram/TopProgram')}" message="Top level program not created! Missing ${package.configbindir}/TopProgram/TopProgram."/>
		<fail unless="@{FileExists('${package.configbindir}/TopProgram/MidSo.so')}" message="Direct dependency .so not copied to program directory! Missing ${package.configbindir}/TopProgram/MidSo.so."/>
		<fail unless="@{FileExists('${package.configbindir}/TopProgram/BotSoViaMidSo.so')}" message="Transitive program => .so => .so dependency not copied to program directory! Missing ${package.configbindir}/TopProgram/BotSoViaMidSo.so."/>
		<fail unless="@{FileExists('${package.configbindir}/TopProgram/BotSoViaMidSoNoLink.so')}" message="Transitive program => .so =(nolink)=> .so dependency not copied to program directory! Missing ${package.configbindir}/TopProgram/BotSoViaMidSoNoLink.so."/>
		<fail unless="@{FileExists('${package.configbindir}/TopProgram/BotSoViaMidLib.so')}" message="Transitive program => .a => .so dependency not copied to program directory! Missing ${package.configbindir}/TopProgram/BotSoViaMidLib.so."/>
		<fail unless="@{FileExists('${package.configbindir}/TopProgram/BotSoViaMidLibNoLink.so')}" message="Transitive program => .a =(nolink)=> .so dependency not copied to program directory!  Missing ${package.configbindir}/TopProgram/BotSoViaMidLibNoLink.so."/>

		<echo message="All files copied to output as expected!" loglevel="minimal"/>
	</target>

</project>
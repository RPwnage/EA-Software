<!DOCTYPE html>
<html>

  <!-- Setup:
  This file requires installed in this directory:
    * jsoneditor.min.js (see https://github.com/jdorn/json-editor)
    * an appropriate JSON schema, saved as 'schema_gpplayers.json' (e.g. you could convert one from data, via https://www.jsonschema.net/)
    * Optional: you can pre load data by saving to this directory a file named 'gpplayers.json'. (Otherwise, user needs to explicitly load a local file, via the UI).
  -->

  <head>
    <meta charset="utf-8" />
    <title>Sample Web UI: GamePackerTool Player Data</title>
    <script src="jsoneditor.min.js"></script>
  </head>

  <body>
    <h1>Sample Web UI: GamePackerTool Player Data</h1>

    <a href="webui.html"><b>Back</b></a>
    <br/>

    <br/>
    <!-- TODO: your web page would overwrite the local gpplayers.json with the chosen file. -->
    <!-- Set up Choose File button: Wrap a *hidden* file input, since a visible 'file' input always initially says 'No File Chosen', even though this page may have a file loaded to start with -->
    <input id='input' type='file' name='filename' hidden/>
    <input id='inputButton' type='button' value='Choose File' />
    <br/>
    
    <div id='editor_holder'></div>

    <script>
        ////////////////////////////////////////
        // Set up Choose File button
        function handleFiles() {
          var selection = this.files[0];
          reader.readAsBinaryString(selection);
          //TODO: actually load your file to repopulate UI here
        }
        function openDialog() {
            document.getElementById('input').click();
        }
        document.getElementById('inputButton').addEventListener('click', openDialog);
        document.getElementById("input").addEventListener("change", handleFiles);
    
        ////////////////////////////////////////
        // Set up the JSON generated Input Form
    
        var reader = new FileReader();
        reader.onloadend = function(){
          console.log(reader.result);
        }

        // function to read json from local dir
        var currJson = null;
        function readJsonFile(file) {
            var rawFile = new XMLHttpRequest();
            rawFile.open("GET", file, false);
            rawFile.onreadystatechange = function ()
            {
                if(rawFile.readyState === 4) {
                    if(rawFile.status === 200 || rawFile.status == 0) {
                        currJson = JSON.parse(rawFile.responseText);
                    }
                }
            }
            rawFile.send(null);
        }
        
        var currEditor = null;
        function setupJsonEditor(schemaContents) {
            // Initialize the editor with a JSON schema
            currEditor = new JSONEditor(document.getElementById('editor_holder'),{
                schema: schemaContents
            });
        }

        var schemaFileName = "schema_gpplayers.json"
        readJsonFile(schemaFileName);
        setupJsonEditor(currJson);

        // start with default file loaded
        var defaultFileName = "gpplayers.json";
        readJsonFile(defaultFileName);
        currEditor.setValue(currJson);
    </script>
  </body>
</html>

<!DOCTYPE html>
<html>

  <!-- Setup:
  This file requires installed in this directory:
    * jsoneditor.min.js (see https://github.com/jdorn/json-editor)
    * an appropriate JSON schema, saved as 'schema_gpsettings.json' (e.g. you could convert one from data, via https://www.jsonschema.net/)
    * Optional: you can pre load data by saving to this directory a file named 'gpsettings.json'. (Otherwise, user needs to explicitly load a local file, via the UI).
  -->

  <head>
    <meta charset="utf-8" />
    <title>Sample Web UI: GamePackerTool</title>
    <script src="jsoneditor.min.js"></script>
  </head>
  <body>
    <h1>Sample Web UI: GamePackerTool</h1>

    <div class="panel panel-primary">
        <a href="webui_playerdata.html"><b>Edit Player Data</b></a>
        <br/>
        <br/>
        <button id='submit'><b>Submit Test</b></button>
        <br/>
        <br/>
        <!-- TODO: your web page would overwrite the local gpplayers.json with the chosen file. -->
        <!-- Set up Choose File button: Wrap a *hidden* file input, since a visible 'file' input always initially says 'No File Chosen', even though this page may have a file loaded to start with -->
        <input id='input' type='file' name='filename' hidden/>
        <input id='inputButton' type='button' value='Choose File' />
        <br/>
    </div>
    
    <div id='editor_holder'></div>

    <script>
        ////////////////////////////////////////
        // Set up Choose File button
        function handleFiles() {
          var selection = this.files[0];
          reader.readAsBinaryString(selection);
          //TODO: actually load your file to repopulate UI here
        }
        function openDialog() {
            document.getElementById('input').click();
        }
        document.getElementById('inputButton').addEventListener('click', openDialog);
        document.getElementById("input").addEventListener("change", handleFiles);
    
    
        ////////////////////////////////////////
        // Set up the JSON generated Input Form

        var reader = new FileReader();
        reader.onloadend = function(){
          console.log(reader.result);
        }
        
        // function to read json from local dir
        var currJson = null;
        function readJsonFile(file) {
            var rawFile = new XMLHttpRequest();
            rawFile.open("GET", file, false);
            rawFile.onreadystatechange = function ()
            {
                if(rawFile.readyState === 4) {
                    if(rawFile.status === 200 || rawFile.status == 0) {
                        currJson = JSON.parse(rawFile.responseText);
                    }
                }
            }
            rawFile.send(null);
        }
        
        var currEditor = null;
        function setupJsonEditor(schemaContents) {
            // Initialize the editor with a JSON schema
            currEditor = new JSONEditor(document.getElementById('editor_holder'),{
                schema: schemaContents
            });
            // Hook up the submit button to log to the console
            document.getElementById('submit').addEventListener('click',function() {
                // Get the value from the editor
                //TODO: run the test here!
                console.log(currEditor.getValue());

                
            });
        }

        var schemaFileName = "schema_gpsettings.json"
        readJsonFile(schemaFileName);
        setupJsonEditor(currJson);

        // start with default file loaded
        var defaultFileName = "gpsettings.json";
        readJsonFile(defaultFileName);
        currEditor.setValue(currJson);
    </script>
  </body>
</html>

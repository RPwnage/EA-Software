<project>
    <createtask name="generate_relative_proto_paths">
        <parameters>
            <option name="inputdir" value="Required"/>
            <option name="rootdir" value="Required"/>
        </parameters>
        <code>
            <property name="proto.files.relative" value=""/>
            <eval code="@{DirectoryGetDirectoriesRecursive('${generate_relative_proto_paths.inputdir}', '*', ' ')}"
                  property="directories"
                  type="Function" />

            <property name="directories" value="${property.value} ${generate_relative_proto_paths.inputdir}"/>

            <foreach item="String" in="${directories}" property="directory" delim=" ">
                <eval code="@{DirectoryGetFiles('${directory}', '*.proto', ' ')}"
                  property="files"
                  type="Function" />

                <foreach item="String" in="${files}" property="file" delim=" ">
                    <property name="proto.files.relative" value="${property.value} @{PathGetRelativePath('${file}', '${generate_relative_proto_paths.rootdir}')}"/>
                </foreach>
            </foreach>
        </code>
    </createtask>
</project>
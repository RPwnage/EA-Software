<project>
  <!-- Copyright 2007 Electronic Arts Inc.  All rights reserved. -->

  <dependent name="EATDF"/>

  <!--  **********************
          GENERATE TDF CODE TASK  
          **********************
    -->
  <dependent name="EATDF"/>

  <createtask name="GenTDFTask2">
    <parameters>
      <option name="genRoot" value="${package.${package.name}.dir}/gen/component"/>
      <option name="genHeaderRoot" value="${package.${package.name}.builddir}/gen/include"/>
      <!-- genHeaderName specifies base folder under genHeaderRoot to output to. -->
      <option name="genHeaderName" value="${package.name}/component"/>
      <option name="genSourceRoot" value="${package.${package.name}.builddir}/gen/source/component"/>
      <option name="genTmpRoot" value="${package.${package.name}.builddir}/gen"/>
      <option name="genHeaderPrefix" value="${package.name}/component"/>
      <option name="extraArgs" value=""/>
    </parameters>
    <code>

    <fileset name="tdfFiles" basedir="${GenTDFTask2.genRoot}">
        <includes name="**.tdf" />
        <excludes name="${GenTDFTask2.genRoot}/clubs/**.tdf" if="@{PropertyExists('package.BlazeSDK.ExcludeClubs')}" />
        <excludes name="${GenTDFTask2.genRoot}/example/**.tdf" if="@{PropertyExists('package.BlazeSDK.ExcludeExample')}" />
        <excludes name="${GenTDFTask2.genRoot}/gamereporting/custom/**.tdf" if="@{PropertyExists('package.BlazeSDK.ExcludeGameReportingCustom')}" />
        <excludes name="${GenTDFTask2.genRoot}/dynamicinetfilter/**.tdf" if="@{PropertyExists('package.BlazeSDK.ExcludeDynamicInetFilter')}" /> 
    </fileset>
  
    <task name="package.EATDF.typecomp.task"
          basedir="${GenTDFTask2.genRoot}"
          outdir="${GenTDFTask2.genHeaderRoot}/${GenTDFTask2.genHeaderName}"
          inputs="tdfFiles"
          language="cpp"
          includedirs=""
          headerPrefix="${GenTDFTask2.genHeaderPrefix}"
          client="true"
          extraArgs="${GenTDFTask2.extraArgs}"
          dep="${GenTDFTask2.genSourceRoot}/blazesdktdf_header.d"
          templates="tdfheaderfile={RelativeDirNoGen}/tdf/{FileBase}.h"
          templatedirs="${package.EATDF.dir}/tool/templates/cpp ${package.EATDF.dir}/tool/templates/protobuf"
          />

      <task name="package.EATDF.typecomp.task"
          basedir="${GenTDFTask2.genRoot}"
          outdir="${GenTDFTask2.genSourceRoot}"
          inputs="tdfFiles"
          language="cpp"
          includedirs=""
          headerPrefix="${GenTDFTask2.genHeaderPrefix}"
          client="true"
          extraArgs="${GenTDFTask2.extraArgs}"
          dep="${GenTDFTask2.genSourceRoot}/blazesdktdf.d"
          templates="tdfsource={RelativeDirNoGen}/tdf/{FileBase}.cpp"
          templatedirs="${package.EATDF.dir}/tool/templates/cpp ${package.EATDF.dir}/tool/templates/protobuf"
          />

      </code>
    </createtask>

    <!--  **********************
          GENERATE RPC TASK  
          **********************
    -->
    <createtask name="GenRPCTask2">
      <parameters>
        <option name="genRoot" value="${package.${package.name}.dir}/gen"/>
        <option name="genHeaderRoot" value="${package.${package.name}.builddir}/gen/include"/>
        <!-- genHeaderName specifies base folder under genHeaderRoot to output to. -->
        <option name="genHeaderName" value="${package.name}"/>
        <option name="genSourceRoot" value="${package.${package.name}.builddir}/gen/source"/>
        <option name="genTmpRoot" value="${package.${package.name}.builddir}/gen"/>
        <option name="templateDirs" value="${package.EATDF.dir}/tool/templates/cpp ${package.EATDF.dir}/tool/templates/protobuf ${package.BlazeSDK.dir}/tools/typecomp2/templates/cpp/client ${package.BlazeSDK.dir}/tools/typecomp2/templates/cpp/shared"/>
        <option name="genHeaderPrefix" value="${package.name}"/>
        <option name="noCentral" value="false"/>
        <option name="extraArgs" value=""/>
      </parameters>
      <code>

        <fileset name="rpcFiles" basedir="${GenRPCTask2.genRoot}">
            <includes name="**.rpc" />
            <excludes name="${GenRPCTask2.genRoot}/component/clubs/**.rpc" if="@{PropertyExists('package.BlazeSDK.ExcludeClubs')}" />
            <excludes name="${GenRPCTask2.genRoot}/component/example/**.rpc" if="@{PropertyExists('package.BlazeSDK.ExcludeExample')}" />
            <excludes name="${GenRPCTask2.genRoot}/component/gamereporting/custom/**.rpc" if="@{PropertyExists('package.BlazeSDK.ExcludeGameReportingCustom')}"/>
            <excludes name="${GenRPCTask2.genRoot}/component/dynamicinetfilter/**.rpc" if="@{PropertyExists('package.BlazeSDK.ExcludeDynamicInetFilter')}"/>
        </fileset>

        <property name="includeDirs">
            ${GenRPCTask2.genRoot}
            ${GenRPCTask2.genRoot}/component
        </property>

        <task name="package.EATDF.typecomp.task"
            basedir="${GenRPCTask2.genRoot}"
            outdir="${GenRPCTask2.genHeaderRoot}/${GenRPCTask2.genHeaderName}"
            templatedirs="${GenRPCTask2.templateDirs}"
            includedirs="${includeDirs}"
            inputs="rpcFiles"
            templates="rpcclientcomponentheader=component/{ComponentName}component.h"
            language="cpp"
            client="true"
            headerPrefix="${GenRPCTask2.genHeaderPrefix}"
            extraArgs="${GenRPCTask2.extraArgs}"
            dep="${GenRPCTask2.genSourceRoot}/blazerpc_header.d"
            />
            
        <task name="package.EATDF.typecomp.task"
            basedir="${GenRPCTask2.genRoot}"
            outdir="${GenRPCTask2.genSourceRoot}"
            templatedirs="${GenRPCTask2.templateDirs}"
            includedirs="${includeDirs}"
            inputs="rpcFiles"
            templates="rpcclientcomponentsource=component/{ComponentName}component.cpp "
            language="cpp"
            client="true"
            headerPrefix="${GenRPCTask2.genHeaderPrefix}"
            extraArgs="${GenRPCTask2.extraArgs}"
            dep="${GenRPCTask2.genSourceRoot}/blazerpc.d"
            />

        <do if="${GenRPCTask2.noCentral} == false">
            <property name="GenRPCTask2.templates">
                rpcclienterrortypeheader=blazeerrortype.h
                rpcclienterrorheader=blazeerrors.h
                rpcclientcomponentmanagerheader=componentmanager.h
            </property>

            <task name="package.EATDF.typecomp.task"
                basedir="${GenRPCTask2.genRoot}"
                outdir="${GenRPCTask2.genHeaderRoot}/${GenRPCTask2.genHeaderName}"
                templatedirs="${GenRPCTask2.templateDirs}"
                includedirs="${includeDirs}"
                inputs="rpcFiles"
                templates="${GenRPCTask2.templates}"
                language="cpp"
                client="true"
                headerPrefix="${GenRPCTask2.genHeaderPrefix}"
                combine="true"
                extraArgs="${GenRPCTask2.extraArgs}"
                dep="${GenRPCTask2.genSourceRoot}/blazerpc_central_header.d"
                />

            <task name="package.EATDF.typecomp.task"
                basedir="${GenRPCTask2.genRoot}"
                outdir="${GenRPCTask2.genSourceRoot}"
                templatedirs="${GenRPCTask2.templateDirs}"
                includedirs="${includeDirs}"
                inputs="rpcFiles"
                templates="rpcclientcomponentmanagersource=componentmanager.cpp"
                language="cpp"
                client="true"
                headerPrefix="${GenRPCTask2.genHeaderPrefix}"
                combine="true"
                extraArgs="${GenRPCTask2.extraArgs}"
                dep="${GenRPCTask2.genSourceRoot}/blazerpc_central.d"
                />
        </do>
      </code>
    </createtask>

</project>
